{% extends "auctions/layout.html" %}
{% load static %}

{% block extra_css %}
    <link href="{% static 'auctions/listing.css' %}" rel="stylesheet">
{% endblock %}

{% block body %}
    <div class="listing-detail-card">
        <div class="listing-detail-image">
            {% if listing.image_url %}
                <img src="{{ listing.image_url }}" alt="{{ listing.title }}" />
            {% else %}
                <img src="https://via.placeholder.com/300x300?text=No+Image" alt="No image" />
            {% endif %}
        </div>
        <div class="listing-detail-info">
            <h2>{{ listing.title }}</h2>
            <p>{{ listing.description }}</p>
            <p><strong>Category:</strong> {{ listing.category.name }}</p>
            <p><strong>Starting bid:</strong> ${{ listing.starting_bid }}</p>
            <p><strong>Owner:</strong> {{ listing.owner.username }}</p>
            <p><strong>Created at:</strong> {{ listing.created_at }}</p>
            <p><strong>Status:</strong> {% if listing.is_active %}Active{% else %}Closed{% endif %}</p>
            <p><strong>Current price:</strong> ${{ listing.get_current_price }}</p>

            <!-- Watchlist Button -->
             {% if user.is_authenticated %}
                <form method="post" action="{% url is_watchlisted|yesno:'remove_from_watchlist,add_to_watchlist' listing.id %}">
                    {% csrf_token %}
                        {% if is_watchlisted %}
                            <button type="submit" class="watchlist-btn remove">Remove from Watchlist</button>
                        {% else %}
                            <button type="submit" class="watchlist-btn add">Add to Watchlist</button>
                        {% endif %}
                </form>
             {% endif %}

            <!-- Delete Button (show only if user is owner) -->
            {% if user.is_authenticated and user == listing.owner %}
                <form method="post" action="" style="margin-top:10px;">
                    {% csrf_token %}
                    <button type="submit" class="delete-btn">Close Auction</button>
                </form>
            {% endif %}
        </div>
    </div>

    <!-- Comments Section -->
    <div class="comments-section">
        <h3>Comments</h3>
        {% if comments %}
            <ul class="comments-list">
                {% for comment in comments %}
                    <li>
                        <strong>{{ comment.user.username }}</strong> ({{ comment.created_at }}):<br>
                        {{ comment.text }}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No comments yet.</p>
        {% endif %}

        {% if user.is_authenticated %}
            <a href="">add comment</a>
        {% else %}
            <p><a href="{% url 'login' %}">Log in</a> to post a comment.</p>
        {% endif %}
    </div>
{% endblock %}